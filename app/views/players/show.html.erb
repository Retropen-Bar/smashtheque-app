<% modal_id = "player-#{player.id}" %>

<div class="container-lg">
  <article class="show-page">
    <section class="show-page-header card">
      <div class="show-page-header-bg"
      
      style="<%=
          "background-color: #{@background_color};" if @background_color
        %><%=
          "background-image: url(\"#{@background_image_url.gsub('"', "\"")}\");" if @background_image_url
        %><%=
          "background-image: url(\"#{image_url('static-bg.png').gsub('"', "\"")}\");" if @static
        %>"
      ></div>
      <div class="card justify-content-start">
        <div class="show-page-header-content card-body">
          <div class="show-page-avatar">
            <% if player.is_legit? %>
              <%= player.avatar_tag(94) %>
            <% end %>
          </div>
          <div class="show-page-meta badge badge-pill d-inline-flex d-md-none">
            <div class="list-characters-compact list-characters-compact--sm mx-auto">
              <% player.characters[0...3].each do |character| %>
                <%= character.decorate.link %>
              <% end %>
              <button class="btn btn-sm btn-see-more" data-toggle="modal" data-target="#<%= modal_id %>">
                <span class="sr-only">Voir plus</span>
                <%= svg_icon_tag(:suspension) %>
              </button>
            </div>
          </div>
          <div class="show-page-main-info">
            <h1 class="show-page-title card-title text-truncate">
              <% if player.is_legit? %>
                <%= link_to player.name, player %>
              <% else %>
                -
              <% end %>
            </h1>
            <% if player.is_legit? && player.teams.present? %>
              <small class="list-teams player-teams">
                <% player.teams.each do |team| %>
                  <div class="list-team"><%= team.short_name %></div>
                <% end %>
              </small>
            <% end %>
            <% player.user&.addresses&.each do |address| %>
              <small class="player-community">
                <i class="fas fa-map-marker-alt"></i>
                <%= address[:name] %>
              </small>
            <% end %>
          </div>
          <div class="show-page-socials">
            <%= render 'player_accounts_v2', player: player %>
          </div>
        </div>
      </div>
    </section>
    <nav class="show-page-nav section-nav players d-md-none">
      <div class="section-nav-wrapper">
        <div class="section-nav-bg shadow-lg">
         <%= link_to player_path(player, anchor: 'statistiques'), class: "section-nav-link" do %>
            <%= svg_icon_tag :joueur %>
            <span>Statistiques</span>
          <% end %>
          <%= link_to player_path(player, anchor: 'palmares'), class: "section-nav-link" do %>
            <%= svg_icon_tag :groupe %>
            <span>Palmarès</span>
          <% end %>
        </div>
      </div>
    </nav>
    <section class="show-page-body card">
      <div class="show-page-content card-body">
        <div class="row">
          <section id="statistiques" class="show-page-section col-md-6">
            <div class="show-page-section-title">
              <h2>Statistiques</h2>
              <span class="show-page-section-title-separator"></span>
            </div>
            <div class="show-page-section-body">
              <%= render 'shared/rewards/rewards', awarded: player %>
            </div>
          </section>
          <section id="palmares" class="show-page-section col-md-6 mt-4 mt-md-0">
            <div class="show-page-section-title">
              <h2>Palmarès</h2>
              <span class="show-page-section-title-separator"></span>
            </div>
            <div class="show-page-section-body">
              <% if @tournament_events.count > 0 %>
                <div class="palmares list-y">
                  <% @tournament_events.each do |tournament_event| %>
                    <% met_reward_condition = @met_reward_conditions_by_tournament_event_id[tournament_event.id]&.decorate %>
                    <article class="palmares-item list-x align-items-start">
                      <div class="palmares-rewards text-center mr-2 bg-bg bg-md-layout">
                        <%= met_reward_condition&.reward_badge(size: 24) %>
                        <% if !met_reward_condition&.points.nil? %>
                        <p class="palmares-points d-block rounded-pill bg-layout py-1 px-2 mt-1 mb-0">
                          <%= met_reward_condition&.points_count(16, is_online: met_reward_condition&.reward&.online?, delimiter: '&nbsp;', value: met_reward_condition&.points) %>
                        </p>
                        <% end %>
                      </div>
                      <div class="palmares-info card-box flex-grow-1">
                        <div class="card-body py-3">
                          <div class="list-y">
                            <div>
                              <time class="palmares-date" datetime="<%= tournament_event.date.to_s(:db) %>"><%= l tournament_event.date, format: :long %></time>
                              <h3 class="palmares-title"><%= tournament_event.player_rank_name(@player.id) %> - <%= tournament_event.participants_count %> participants</h3>
                            </div>
                            <div class="palmares-tournament d-flex">
                              <div class="palmares-tournament-logo mr-2">
                                <%= tournament_event.recurring_tournament&.decorate&.any_image_tag %>
                              </div>
                              <div class="palmares-tournament-names d-flex flex-column">
                                <p class="m-0"><%= tournament_event.recurring_tournament&.name %></p>
                                <%= tournament_event.link(label: tournament_event.name, class: "text-accent font-weight-bolder text-decoration") %>
                              </div>
                            </div>
                          </div>
                        </div>
                        <div class="card-footer bg-layout bg-md-bg">
                          <div class="d-flex justify-content-around align-items-center">
                            <%= tournament_event.bracket_icon_link(text: 'Bracket', class: ' palmares-action-link  font-weight-bolder', backet_icon_options: {height: 12, class: 'text-accent'}) %>
                            
                            <button type="button"
                                    class="palmares-action-link btn btn-sm btn-link btn-with-icon rounded-pill font-weight-bolder"
                                    data-toggle="modal"
                                    data-target="#top8-<%= tournament_event.id %>-modal">
                                    <%= svg_icon_tag(:top3, class: 'text-accent mr-0') %>&nbsp;Top 8</button>
                          </div>
                        </div>
                      </div>
                    </article>
                    <%= render 'top8_modal', tournament_event: tournament_event, modal_id: "top8-#{tournament_event.id}-modal" %>
                  <% end %>
                </div>
              <% else %>
                <p>Aucun palmarès</p>
              <% end %>
            </div>
          </section>
        </div>
      </div>
    </section>
  </article>
</div>
<%= render 'characters_modal', modal_id: modal_id %>