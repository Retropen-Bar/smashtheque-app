<div class="text-center">
  <div id="list-toolbar">
    <h1 class="page-title">Planning</h1>
  </div>
</div>

<div id="filters-wrapper">

  <%= form_tag nil, method: :get, id: "filters" do %>

    <div class="form-row">
      <div class="col-6">
        <strong>Niveau</strong>
        <% RecurringTournament::LEVELS.each do |level| %>
          <% id = "level-#{level}" %>
          <div class="custom-control custom-switch">
            <input class="custom-control-input" type="checkbox" value="<%= level %>" id="<%= id %>">
            <% color = RecurringTournamentDecorator.level_color(level) %>
            <label class="custom-control-label text-<%= color %>" for="<%= id %>">
              <%= RecurringTournament.human_attribute_name("level.#{level}") %>
            </label>
          </div>
        <% end %>
      </div>
    </div>

  <% end %>

</div>

<div id="planning"></div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    var calendarEl = document.getElementById("planning");
    var calendar = new FullCalendar.Calendar(calendarEl, {
      themeSystem: 'bootstrap',
      initialView: 'customTimeGrid',
      // contentHeight: 400,
      initialDate: '<%= @monday %>',
      locale: 'fr',
      firstDay: 1,
      height: 'auto',
      views: {
        customTimeGrid: {
          type: 'timeGrid',
          duration: { days: 7 },
          // scrollTime: '12:00:00',
          allDaySlot: false,
          nowIndicator: true,
          slotMinTime: '08:00:00',
          slotDuration: '01:00:00'
        }
      },
      events: function(fetchInfo, successCallback, failureCallback) {
        var params = fetchInfo;
        params.by_level_in = [];
        for (var level of <%= RecurringTournament::LEVELS.to_json.html_safe %>) {
          if ($('form#filters input#level-' + level).is(':checked')) {
            params.by_level_in.push(level);
          }
        }
        if (params.by_level_in.length < 1) {
          delete params['by_level_in'];
        }
        $.ajax({
          dataType: "json",
          url: '<%= recurring_tournaments_path(format: :json) %>',
          data: params,
          success: successCallback,
          error: failureCallback
        });
      }
    });
    calendar.render();
    $('form#filters').on('change', 'input', function() {
      calendar.refetchEvents();
    });
  });
</script>
